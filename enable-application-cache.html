<!DOCTYPE html>
<!--
(¯`·.¸¸.·´¯`·.¸¸.-> ĊÄĻĻ MË ĻŮŚÏŖ <-.¸¸.·´¯`·.¸¸.·´¯)
-->
<html lang="en-US">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="format-detection" content="telephone=no">
<meta name="renderer" content="webkit">
<meta name="author" content="Nero Zheng" />
<meta name="generator" content="Pelican" />
<meta name="description" content="启用 Application Cache - 作者：Nero Zheng，首发于『擼sirの避風港』">
<meta property="qc:admins" content="315026325312655" />
<meta property="wb:webmaster" content="8e383b094667a02d" />
<title>启用 Application Cache - 擼sirの避風港</title>
<link href="http://lusir.me/atom.xml" type="application/atom+xml" rel="alternate" title="『擼sirの避風港』Atom Feed" />
<link href="http://lusir.me/rss.xml" type="application/rss+xml" rel="alternate" title="『擼sirの避風港』Rss Feed" />
<link rel="shortcut icon" type="image/x-icon" href="http://lusir.me/images/favicon/favicon.ico" />
<link rel="apple-touch-icon" sizes="114x114" href="http://lusir.me/images/favicon/apple-touch-icon-114x114.png" />
<link rel="icon" type="image/png" href="http://lusir.me/images/favicon/favicon-32x32.png" sizes="32x32" />
<script src="http://lusir.me/theme/js/basket.min.js"></script>
<script>
basket.require({ url: 'http://lusir.me/theme/css/bootstrap.min.css' },{ url: 'http://lusir.me/theme/css/niu2.css', unique: 0.1 },{ url: 'http://lusir.me/theme/font-awesome/css/font-awesome.min.css', unique: 0.1 },{ url: 'http://lusir.me/theme/css/pygments/github.css' },{ url: 'http://lusir.me/theme/css/jquery.fancybox.css' },{ url: 'http://lusir.me/hermit/style/hermit.min.css', unique: 0.1 })
.then(function(responses) {
_stylesheet.appendStyleSheet(responses[0], function() {});
	basket.require({ url: 'http://lusir.me/theme/js/bootstrap.min.js' },{ url: 'http://lusir.me/theme/js/jquery-1.11.0.min.js' },{ url: 'http://lusir.me/theme/js/niu2.js', unique: 0.1 },{ url: 'http://lusir.me/theme/js/fancy-loading.js' },{ url: 'http://lusir.me/theme/js/jquery.fancybox.pack.js' },{ url: 'http://lusir.me/hermit/script/hermit.min.js', unique: 0.1 },{ url: 'http://lusir.me/theme/js/jquery-1.4.4.min.js' },{ url: 'http://lusir.me/theme/js/slimbox2.js' },{ url: 'http://lusir.me/theme/soundmanager2/script/soundmanager2.min.js' },{ url: 'http://lusir.me/theme/js/tagcloud.min.js' });});
</script>
<link rel="stylesheet" href="http://lusir.me/theme/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="http://lusir.me/theme/font-awesome/css/font-awesome.min.css" type="text/css" />
<link rel="stylesheet" href="http://lusir.me/theme/css/niu2.css" type="text/css" />
<script type="text/javascript">window.onload = function() {  };</script>
<link rel="stylesheet" href="http://lusir.me/theme/css/pygments/github.css" type="text/css" />
<link rel="stylesheet" href="http://lusir.me/theme/css/jquery.fancybox.css" type="text/css" />
<link rel="canonical" href="http://lusir.me/enable-application-cache.html" />
<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
<script src="http://lusir.me/theme/js/html5shiv.js"></script>
<script src="http://lusir.me/theme/js/respond.min.js"></script>
<![endif]-->
<!--[if IE 7]>
<link rel="stylesheet" href="http://lusir.me/theme/font-awesome/css/font-awesome-ie7.min.css" type="text/css" />
<![endif]-->
</head>

<body itemscope itemtype="http://schema.org/WebPage"> 
<meta itemprop="inLanguage" content="zh-CN">
<div id="body-header">
<div class="navbar navbar-inverse navbar-fixed-top">
<div class="col-md-12">
<div class="navbar-header">
<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a class="navbar-brand" href="http://lusir.me"><i class="fa fa-home"></i>擼sirの避風港</a>
</div>
<nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
<ul class="nav navbar-nav">
<li><a href="http://lusir.me/about.html" title="关于"><i class="fa fa-anchor"></i>关于</a></li>
<li><a href="http://lusir.me/archives.html" title="存档"><i class="fa fa-archive"></i>存档</a></li>
<li><a href="http://lusir.me/tag/" title="标签"><i class="fa fa-tag"></i>标签</a></li>
<!-- category dropdown list -->
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-folder-open"></i>分类<b class="caret"></b></a>
<ul class="dropdown-menu">
<li><a href="http://lusir.me/collection/index.html"><i class="fa fa-briefcase"></i>搜藏(4)</a></li>
<li><a href="http://lusir.me/nonsense/index.html"><i class="fa fa-trash"></i>扯(1)</a></li>
<li><a href="http://lusir.me/record/index.html"><i class="fa fa-book"></i>记录(74)</a></li>
</ul>
</li>
<!--  self defined dropdown list --></ul>
<!-- right nav bar -->
<ul class="nav navbar-nav navbar-right">
<!-- google custom search --><li>
<div id="niu2-cse-wrapper">
<div id="niu2-cse-header-box" class="navbar-form navbar-nav">
<form action="/search.html" method="get">
<div class="form-group">
<input id="niu2-cse-search-input" class="niu2-cse-header form-control" type="text" name="q" placeholder="回车以搜索…" />
</div>
</form>
</div>
<div id="niu2-cse-ctrl-box" class="navbar-nav"><i id="niu2-cse-search-image" class="fa fa-search navbar-nav"></i><span id="niu2-cse-search-text">搜索</span></div>
</div>
</li></ul>
</nav>
</div>
</div></div>
		
<div id="body-content" itemscope="itemscope" itemtype="http://schema.org/Article"><div class="col-md-8 col-md-offset-2"><h1 id="content-heading" itemprop="headline">启用 Application Cache</h1></div>
<div id="niu2-left-container" class="col-md-6 col-md-offset-2">
<div id="niu2-main-content" itemprop="articleBody">
<p>上篇<a href="http://lusir.me/modify-dns-name-resolution.html" title="更改域名解析">更改域名解析</a>之后，本站裸域名改成 A 记录到 IP，也就是不能享受 CDN 加速了。由于现在站点目录下全是静态页，HTML5 的脱机数据功能说不定会带来更好的用户体验，于是尝试启用了，记录一下折腾过程。
</p>
<p>启用 HTML5 Application Cache 的步骤全摘自网络，自己只是当了一次小白，具体的原理不明。具体步骤分 3 步：</p>
<ol>
<li>创建一个 cache.appcache 文件，并确保文件具有正确的内容；</li>
<li>在服务器上设置内容类型；</li>
<li>所有的 HTML 文件都指向 cache.appcache。</li>
</ol>
<h3 id="7902e56ddfc26a187defd7c20936eb0b">创建 appcache 文件</h3>
<p>新建 cache.appcache 文件，写入类似以下类容：</p>
<div class="codehilite"><pre>CACHE MANIFEST
#v1
CACHE:
index.html
404.html
favicon.ico
robots.txt
humans.txt
apple-touch-icon.png
css/normalize.min.css
css/main.css
css/bootmetro-icons.min.css
img/pho-cat.jpg
img/pho-huangshan.jpg

NETWORK:
*
</pre></div>


<p>注：首行须确保为 CACHE MANIFEST。<code>#</code> 表示注释，有文章或 css、js、img 等内容变化时需要更新 cache.appcache 以使来访浏览器更新 cache.appcache 中列出的条目，所以更新注释是一个简便方法。<a href="http://lusir.me/nero.appcache" title="我的 cache.appcache">我的 cache.appcache</a>。</p>
<h3 id="e8d669ed787e0f6ca71ae5e3dcc9c41a">设置内容类型</h3>
<p>在 .htaccess 文件中添加以下内容（我没有 .htaccess，所以没添加）</p>
<div class="codehilite"><pre>AddType text/cache-manifest .manifest
</pre></div>


<h3 id="fe9e55b4442b03a4781c410d6a9596c1">将 HTML 页面指向清单文件 cache.appcache</h3>
<p>在页首的 <code>&lt;html&gt;</code> 中添加 <code>manifest="/cache.appcache"</code>（假设该文件放置在根目录）。即：</p>
<div class="codehilite"><pre>&lt;html manifest=&quot;/cache.appcache&quot;&gt;
</pre></div>


<p>完成以上 3 个步骤，来访浏览器在下载完列表中文件后会通过直接访问本地缓存，从而使网页打开速度更快，甚至在离网的情况下仍能直接访问页面缓存。</p>
<h3 id="1f03fb4a4295fecc5fbf72259a70cfd4">使用 js 让来访浏览器及时刷新缓存</h3>
<p>发布新文章时我尝试了更改 cache.appcache 的注释，但浏览器仍显示旧的信息，必须手动清除浏览器缓存。显然，这样把事情弄得更麻烦了，所以我在页面添加了如下类容以使浏览器自动强制刷新，带来的问题是强制刷新过程很明显，可能会使用户体验下降。</p>
<div class="codehilite"><pre><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text/javascript&quot;</span><span class="o">&gt;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">applicationCache</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;updateready&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">applicationCache</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="nb">window</span><span class="p">.</span><span class="nx">applicationCache</span><span class="p">.</span><span class="nx">UPDATEREADY</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">reload</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{}</span>
  <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
<span class="o">&lt;</span><span class="err">/script&gt;</span>
</pre></div>


<p>先试用一段时间再说，不行就把它撤了。</p>
<h3 id="2a302fa545ce4445b25970650930debd">参考文章</h3>
<ul>
<li><a href="http://html5g.cn/html5-application-cache.html" title="利用HTML5应用程序缓存运行一个离线 Web 网页或应用">利用HTML5应用程序缓存运行一个离线 Web 网页或应用</a></li>
<li><a href="http://www.cnblogs.com/svage/archive/2011/11/24/2261365.html" title="html5 离线应用 application cache">html5 离线应用 application cache</a></li>
<li><a href="http://www.html5rocks.com/en/tutorials/appcache/beginner/" title="A Beginner's Guide to Using the Application Cache">A Beginner's Guide to Using the Application Cache</a></li>
</ul>
<p>附：<a href="http://manifest-validator.com/" title="Cache Manifest Validator">Cache Manifest Validator</a></p>
<h3 id="06933067aafd48425d67bcb01bba5cb6">Update</h3>
<ul>
<li>2014.04.01 由于没能处理好 appcache 对于加载元素的缓存与更新之间的矛盾，放弃使用 Application Cache 转投 <a href="http://lusir.me/enable-localstorage.html" title="启用 Localstorage">localstorage</a>。</li>
</ul>
</div>
    
<div id="content-comments">
<div id="disqus_thread"></div>
<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'z327774948'; // required: replace example with your forum shortname
/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

</div>
<div id="niu2-right-container" class="col-md-3">
<div id="niu2-sidebar-meta" class="niu2-sidebar">
<div class="niu2-sidebar-label"><i class="fa fa-bug"></i>文章作者</div>
<div class="niu2-sidebar-value" itemprop="author">Nero Zheng</div><p class="hidden">By Nero Zheng</p>
<div class="niu2-sidebar-label"><i class="fa fa-calendar"></i>发布时间</div>
<div class="niu2-sidebar-value" itemprop="datePublished">2014-03-13 14:40</div>
<div class="niu2-sidebar-label"><i class="fa fa-pencil"></i>最后修改</div>
<div class="niu2-sidebar-value" itemprop="dateModified">2014-04-01 10:25</div>
<div class="niu2-sidebar-label"><i class="fa fa-book"></i>分类</div>
<div class="niu2-sidebar-value" itemprop="articleSection"><a href="http://lusir.me/record/index.html">记录</a></div>
<div class="niu2-sidebar-label"><i class="fa fa-tag"></i>标签</div>
<div class="niu2-sidebar-inter-value niu2-sidebar-tag" itemprop="keywords"><a href="http://lusir.me/tag/html5.html">HTML5</a></div>
 
</div>

<div id="niu2-sidebar-toc" class="niu2-sidebar" data-status="closed">
<div class="niu2-sidebar-label">
<i id="niu2-sidebar-toc-ctrl" class="fa fa-plus"></i>目录
</div>
<ol id="niu2-sidebar-toc-list">
<li><a href="#content-heading">启用 Application Cache</a></li>
    <li><a href='#7902e56ddfc26a187defd7c20936eb0b'>创建 appcache 文件</a></li><li><a href='#e8d669ed787e0f6ca71ae5e3dcc9c41a'>设置内容类型</a></li><li><a href='#fe9e55b4442b03a4781c410d6a9596c1'>将 HTML 页面指向清单文件 cache.appcache</a></li><li><a href='#1f03fb4a4295fecc5fbf72259a70cfd4'>使用 js 让来访浏览器及时刷新缓存</a></li><li><a href='#2a302fa545ce4445b25970650930debd'>参考文章</a></li><li><a href='#06933067aafd48425d67bcb01bba5cb6'>Update</a></li>
<li><a href="#content-comments">评论</a></li>
</ol></div>

<div class="hidden">
<div itemscope itemtype="http://data-vocabulary.org/Breadcrumb"><a href="http://lusir.me" itemprop="url"><span itemprop="title">Home</span></a>&nbsp;&gt;&nbsp;</div>
<div itemscope itemtype="http://data-vocabulary.org/Breadcrumb"><a href="http://lusir.me/record/index.html" itemprop="url"><span itemprop="title">记录</span></a></div>&nbsp;&gt;&nbsp;启用 Application Cache
</div>

<div class="hidden">
<ul>
<li class="prev"><a href="http://lusir.me/modify-dns-name-resolution.html">上一篇</a></li>
<li class="next"><a href="http://lusir.me/after-enabling-application-cache.html">下一篇</a></li>
</ul>
</div>

<div class="hidden">
<p>相关文章</p>
<ul>
<li><a href="http://lusir.me/enable-localstorage.html">启用 LocalSotrage</a></li>
<li><a href="http://lusir.me/after-enabling-application-cache.html">启用 Application Cache（续）</a></li>
<li><a href="http://lusir.me/embed-html5-media.html">在网页中嵌入 html5 音视频</a></li>
</ul>
 
</div></div>
</div><div id="body-footer" class="col-md-6 col-md-offset-2"><div class="niu2-footer">
<hr/>
<p>
&copy; 擼sirの避風港.&nbsp;Powered by <a href="https://github.com/getpelican/pelican">Pelican</a>, 
Theme by <a href="https://blog.atime.me/">Ma Wenbao</a>. 
No Right Reserved<a href="https://plus.google.com/+NeroZheng" rel="author">.</a>
</p>
</div></div>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script type="text/javascript" src="http://lusir.me/theme/js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="http://lusir.me/theme/js/niu2.js"></script>
<script type="text/javascript" src="http://lusir.me/theme/js/bootstrap.min.js"></script>
<script type="text/javascript" src="http://lusir.me/theme/js/fancy-loading.js"></script>
<script type="text/javascript" src="http://lusir.me/theme/js/jquery.fancybox.pack.js"></script>
<script type="text/javascript">onContentLoaded();</script>

<!-- GoogleAnalytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-36540079-1', 'lusir.me');
ga('require', 'linkid', 'linkid.js');
ga('send', 'pageview');
</script>

<!-- Baidu Autopush -->
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';}
    else {bp.src = 'http://push.zhanzhang.baidu.com/push.js';}
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);})();
</script>

<!-- Baidu Tongji -->
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fffe778a70caf3e0916e5372ab2ebb506' type='text/javascript'%3E%3C/script%3E"));
</script>

</body>
</html>